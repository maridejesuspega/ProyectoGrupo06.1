<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns="http://www.w3.org/1999/xhtml">
<head th:replace="~{layout/plantilla :: head}">
    <title>Iniciar Sesión - Clinica Veterinaria VidaAnimal</title>
</head>
<body class="bg-custom-light">
    <header th:replace="~{layout/plantilla :: header}"/>
    
    <main class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title text-center mb-4">Iniciar Sesión</h2>
                        
                        <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
                        <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
                        
                        <form th:action="@{/login}" method="post" class="needs-validation" novalidate>
                            <div class="mb-3">
                                <label for="tipoUsuario" class="form-label">Tipo de Usuario <span class="text-danger">*</span></label>
                                <select class="form-select" id="tipoUsuario" name="tipoUsuario" required>
                                    <option value="">Seleccione un tipo de usuario</option>
                                    <option value="CLIENTE">Cliente</option>
                                    <option value="ADMINISTRADOR">Administrador</option>
                                    <option value="VETERINARIO">Veterinario</option>
                                </select>
                                <div class="invalid-feedback">
                                    Por favor seleccione un tipo de usuario
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                                <input type="email" 
                                       class="form-control" 
                                       id="email" 
                                       name="email" 
                                       required
                                       pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                                <div class="invalid-feedback">
                                    Por favor ingrese un email válido
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Contraseña <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input type="password" 
                                           class="form-control" 
                                           id="password" 
                                           name="password" 
                                           required
                                           minlength="8">
                                    <button class="btn btn-outline-secondary" 
                                            type="button" 
                                            id="togglePassword">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback">
                                    Por favor ingrese su contraseña
                                </div>
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="recordar" name="recordar">
                                <label class="form-check-label" for="recordar">Recordar sesión</label>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" style="background-color: #3CB371; color: #FFFFFF; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer;" th:text= "'Iniciar Sesión'">Iniciar Sesión</button>
                            </div>
                        </form>
                        
                        <div class="text-center mt-3">
                            <p>¿No tienes una cuenta? <a th:href="@{/registro}">Regístrate aquí</a></p>
                            <p><a th:href="@{/recuperar-password}">¿Olvidaste tu contraseña?</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{layout/plantilla :: footer}"/>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Validación del formulario
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()

        // Toggle password visibility
        document.getElementById('togglePassword').addEventListener('click', function() {
            const password = document.getElementById('password');
            const icon = this.querySelector('i');
            
            if (password.type === 'password') {
                password.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                password.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });
    </script>
</body>
</html>